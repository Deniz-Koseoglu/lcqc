### Деконволюция

Этот модуль реализует **итеративную аппроксимацию кривых (ICF)** для моделирования хроматографических пиков. 
ICF аппроксимирует несколько гауссовых и модифицированных гауссовых моделей к одному или группе хроматографических 
пиков и минимизирует связанную **среднеквадратическую ошибку (RMSE)** результирующей модели через итеративную 
оптимизацию. Таким образом, получается модель, максимально близкая к реальному хроматографическому сигналу 
в рамках ограничений выбранной модели. ICF особенно полезен как метод деконволюции пиков для умеренно 
или даже полностью слитых пиков.

Описание включённых опций приведено ниже.
<br></br>
#### Метод деконволюции
Рабочий процесс в настоящее время реализует **4 популярные модели ICF** и предлагает активный выбор 
наиболее подходящей модели для каждого исследуемого пика или группы до **5 слитых пиков**. 
Доступные модели описаны ниже.

**Простая гауссова**
: Простейшая модель, основанная на следующем уравнении (Nikitas *et al.*, [2001](https://doi.org/10.1016/S0021-9673(01)00524-6)):

$$ H_{GS} = H_m\times e^{-((t_R-t_m)/2\sigma)^2} $$ 

Где $H_m$ и $t_R$ — сигнал и время удерживания в максимуме пика соответственно, $t_R$ — текущее время удерживания, 
а $\sigma$ — стандартное отклонение кривой, эффективно аппроксимируемое как половина ширины пика на высоте 
точки перегиба. Таким образом, гауссова модель имеет только 3 параметра для оптимизации и поэтому вычислительно 
дешева, но **не может учитывать фронтирование или хвостование**, часто наблюдаемые в хроматографических данных.

**Экспоненциально-модифицированная гауссова (EMG)**
: Модель EMG (например, Li, [1995](https://www.doi.org/10.1093/chromsci/33.10.568); 
Nikitas *et al.*, [2001](https://doi.org/10.1016/S0021-9673(01)00524-6); 
Caballero *et al.*, [2002](https://doi.org/10.1016/S0021-9673(02)00194-2); 
Kalambet *et al.*, [2011](https://doi.org/10.1002/cem.1343)) включает экспоненциальный компонент в гауссову 
модель и является наиболее популярным подходом к моделированию хроматографических пиков с хвостованием и фронтированием:

$$ H_{EMG} = A\times e^{0.5\times(\sigma/\tau)^2 - ((t_R-t_0)/\tau)}\times\mathcal{P}((t_R-t_0)/\sigma - \sigma/\tau)/\tau $$

Иногда также записывается как (Li, [1997](https://www.doi.org/10.1021/ac970481d)):

$$ H_{EMG} = A/2\tau\times e^{(\sigma^2/2\tau^2 + (t_0-t_R)/\tau)}\times(1+erf((t_R-t_0)/\sqrt{2\sigma} - \sigma/\sqrt{2\tau})) $$ 

Где новые параметры $A$ и $\tau$ — это площадь пика и экспоненциальная постоянная времени соответственно, 
которая отрицательна для фронтирующих пиков и положительна для хвостующих пиков. Модель EMG вычисляется 
дольше, чем GS или EGH, и кажется **менее стабильной**.

**Экспоненциально-гауссов гибрид**
: Модель EGH (Lan & Jorgenson, [2001](https://doi.org/10.1016/S0021-9673(01)00594-5); 
Li, [2002](https://doi.org/10.1016/S0021-9673(02)00090-0)) — упрощённое эмпирическое уравнение, 
которое также учитывает фронтирующие и хвостующие пики путём включения усечённого экспоненциального 
компонента в уравнение:

$$ H_{egh} = H_m\times e^{-(t_{R2}-t_0)^2/(2\sigma^2 + \tau\times(t_{R2}-t_0))} $$

Где $t_{R2}$ — те времена удерживания, где $(2\sigma^2 + \tau\times(t_R-t_0)) > 0$. EGH **сходится значительно быстрее**, 
чем EMG, но несколько уступает в гибкости для моделирования фронтирующих пиков (аналогично EMG).

**Эмпирически преобразованная гауссова**
: Наконец, модель ETG (Li, [1995](https://www.doi.org/10.1093/chromsci/33.10.568), 
[1997](https://www.doi.org/10.1021/ac970481d), [2002](https://doi.org/10.1016/S0021-9673(02)00090-0)) уникальна тем, 
что включает 6 параметров, описывающих **передний** ($k_l$, $\lambda_l$ и $\alpha$) и **задний** ($k_r$, 
$\lambda_r$ и $\beta$) края пика соответственно. Включая высоту пика $H_m$, всего оптимизируется 7 параметров. 
Кроме того, функция требует оценок времён левой и правой точек перегиба ($t_l$ и $t_r$) для каждого пика, 
которые остаются постоянными и не оптимизируются:

$$ H_{etg} = (2H_me^{0.5})/((1 + \lambda_l e^{k_l(t_l - t)})^\alpha + (1 + \lambda_r e^{k_r(t - t_r)})^\beta - 1) $$

Модель ETG предлагает уникальное преимущество слабой связи между описаниями переднего и заднего краёв пика, 
которые связаны только одним параметром амплитуды пика (производным от высоты пика). Кроме того, несмотря 
на итеративную оптимизацию **7 параметров**, процедура аппроксимации сходится быстро 
(**не является** вычислительно затратной).

Все вышеперечисленные функции подаются на итеративную оптимизацию через штрафную функцию, основанную на 
**среднеквадратической ошибке (RMSE)**, которая может быть представлена следующим образом:

$$ RMSE = \sum{\sqrt{(y_i - \hat{y}_i)^2/n}} $$

Где $y_i$, $\hat{y}_i$ и $n$ — исходный сигнал, модельная кривая и размер выборки (количество точек 
в исходных данных) соответственно. Эта метрика ошибки используется для оценки производительности модели 
и **выбора наиболее подходящей модели** среди GS, EMG, EGH и ETG во время итеративной оптимизации.

#### Другие базовые опции

**Определять критическую ширину автоматически**
: Рабочий процесс использует алгоритм FastChrom (Johnsen *et al.*, [2013](https://doi.org/10.1039/c3an36276k)) 
для построения базовых линий для каждого пика. Алгоритм использует параметр критической ширины, который приводит 
к менее строгим правилам коррекции базовой линии при его увеличении. Этот параметр может быть задан вручную 
(как целое число) или определён автоматически на основе значения флажка.

**Моделировать пики, разрешённые по базовой линии**
: По умолчанию пики, разрешённые по базовой линии, не моделируются, так как это не требуется для точного 
интегрирования их площади. Однако их можно моделировать, активировав этот флажок.
<br></br>
#### Дополнительные опции
Вкладка **Дополнительно** представляет дополнительные опции:

**Метод оптимизации**
: Алгоритм(ы), используемые для достижения сходимости при итеративной аппроксимации. Опции включают **Нелдера-Мида**, 
**Бройдена-Флетчера-Голдфарба-Шанно (BFGS)** и его вариант с ограничениями, а также **имитацию отжига**. 
По умолчанию используются все алгоритмы, причём лучший выбирается для каждого пика на основе **RMSE**.

**Представление EMG**
: Выбирает форму уравнения EMG, где **EMG1** — по умолчанию, а **EMG2** — форма, записанная 
Lee *et al.* ([1997](https://www.doi.org/10.1021/ac970481d)). Подробнее см. уравнения EMG выше.
