### Детектирование пиков

Это самый сложный модуль в LCQC, используемый для автоматического обнаружения, фильтрации и классификации 
хроматографических пиков с использованием одномерных данных (только время удерживания и сигнал). Вершины пиков, 
точки перегиба, точки подъёма, а также начальные и конечные точки определяются с помощью комбинации 
пользовательских и отраслевых алгоритмов.

Вкладка **Основные** включает следующие параметры:
<br></br>

#### Метод порога амплитуды
Выбор **одного или нескольких** методов для оценки **порога амплитуды**, ниже которого детектирование пиков 
не выполняется. Доступные методы:

**Z-оценки**
: Вычисляет глобальные средние значения как скользящего среднего, так и скользящего стандартного отклонения 
сигнала и использует параметр чувствительности (см. **Дополнительные параметры**) для расчёта предела амплитуды:

$$ AmpLim = \overline{MX} + (1/sens)\times\overline{SD} $$

**Простые квантили**
: Предел амплитуды просто определяется как квантиль при указанной вероятности в процентах от **0.001 до 50**.

**Относительные разности**
: Сначала вычисляется квантильный диапазон входных данных, определяется максимальная разность между последовательными 
квантилями, находится самый ранний (наименьший) квантиль, где превышается процент этой разности от **0.001 до 50**, 
и этот квантиль используется как предел амплитуды.
<br></br>

#### Обнаружение и устранение группировки пиков
Обнаруживает и удаляет сгруппированные вершины пиков с помощью пользовательского алгоритма.
<br></br>

#### Метод детектирования пиков на основе производных
Метод для расчёта нижнего и верхнего порогов первой/второй производной для детектирования пиков. 
Доступные методы:

**Оценщик ядра шума**
: Следует широко применяемому подходу ядра шума (например, Waters Corporation, [2017](https://www.waters.com/content/dam/waters/en/library/white-papers/2007/720000494en.pdf)). 
Ядро шума определяется как расстояние стандартного отклонения $SD$ от среднего $\overline{X}$ производных:

$$ T=\overline{X}\pm sens1\times SD/sens2 $$

Многие отраслевые подходы рекомендуют значение 4 для $sens1$, утверждая, что $\pm 4SD$ лучше всего определяет 
хроматографический шум.

**Метод Vaz *et al.* ([2016](https://doi.org/10.5935/0103-5053.20160076))**
: Вычисляются разности между глобальной медианой производного сигнала $M_D$ и производным сигналом, 
и из этих результатов рассчитывается новая медиана $M_{new}$. Затем нижний и верхний пороги $T$ вычисляются следующим образом:

$$T=M_D\pm sens1\times M_{new}/sens2$$

Здесь $sens1$ — эмпирический коэффициент, с которым диапазон порогов расширяется/увеличивается.
И наоборот, $sens2$ обратно связан с диапазоном порогов.

**На основе Z-оценок**: Небольшая вариация, основанная исключительно на медиане производных:

$$T=M_D+sens1\times M_D/sens2$$
<br></br>
#### Метод обнаружения выбросов

Этот выпадающий список содержит различные методы удаления выбросов из шумового сигнала. Они включают:

**Межквартильный размах**
: Удаляются все значения за пределами $Q_1-1.5\times IQR$ и $Q_3+1.5\times IQR$ (где $Q_1$, $Q_3$ и $IQR$ — 
первый квартиль, третий квартиль и межквартильный размах соответственно).

**На основе квантилей**
: Удаляются все значения за пределами 2.5% и 97.5% квантилей.

**На основе стандартного отклонения**
: Удаляются все значения за пределами $\overline{X}\pm 2.24\times SD$ (где $\overline{x}$ и $SD$ — 
среднее и стандартное отклонение производных соответственно).
<br></br>
#### Фильтры отклонения пиков
Доступны четыре различных фильтра для отсеивания пиков после начального детектирования на основе 
**отношения сигнал/шум (S/N)**, **высоты** пика, **ширины** в точках перегиба и **площади** пика. 
Эти фильтры применяются в два этапа. Фильтры по высоте и отношению S/N применяются до классификации пиков, 
а фильтры по ширине и площади — после. Также доступны логические переключатели для обоих этапов фильтрации 
(по умолчанию используется логика **ИЛИ**).
<br></br>
#### Дополнительные параметры
Вкладка **Дополнительно** содержит различные параметры для тонкой настройки детектирования пиков.

**Параметры чувствительности**
: Эти параметры контролируют чувствительность детектирования пиков на основе производных и сигнала (предел амплитуды).
Значения чувствительности **первой производной** и **второй производной** эквивалентны $sens1$ и $sens2$ 
в уравнениях выше, а **чувствительность предела амплитуды** используется при расчёте Z-оценок.

**Параметры Z-оценок**
: Различные параметры, контролирующие обнаружение пиковых областей с использованием Z-оценок. 
Параметр **Лаг скользящего среднего/СО (целое число)** — это количество наблюдений для расчёта скользящего 
среднего и стандартного отклонения. Параметр **Порог** — это Z-оценка (множитель стандартного отклонения 
скользящего среднего), при которой алгоритм сигнализирует о наличии положительных или отрицательных пиков. 
Наконец, параметр **Чувствительность к среднему и СО** — это коэффициент от **0 до 1**, обозначающий 
относительное влияние/вес новых точек данных на расчёт скользящего среднего и стандартного отклонения.

**Коррекция базовой линии FastChrom**
: Переключатель для включения или отключения дополнительной коррекции базовой линии с использованием 
алгоритма FastChrom, разработанного Johnsen *et al.* ([2013](https://doi.org/10.1039/c3an36276k)). 
Также должен быть установлен соответствующий параметр **критической ширины**.

**Параметры проверки границ**
: Укажите количество точек для проверки с каждой стороны для подтверждения (или отклонения) 
обнаруженных экстремумов сигнала и производных (т.е. максимумов и минимумов).

**Параметры расширения базовой линии ApexTrack**
: Здесь пользователь может указать параметры **liftoff** и **touchdown** алгоритма ApexTrack, 
разработанного и описанного Waters Corporation ([2017](https://www.waters.com/content/dam/waters/en/library/white-papers/2007/720000494en.pdf)).

**Параметры пересечения нуля**
: Укажите количество точек для проверки с каждой стороны для подтверждения (или отклонения) 
обнаруженных пересечений нуля (нисходящих и восходящих) для сигнала и производных.

#### Классификация пиков
Все обнаруженные пики, перечисленные в **Таблице пиков**, классифицируются на **одну из четырёх** категорий:

1. **B**: Пики, разрешённые по базовой линии.
2. **F**: Слитые пики.
3. **S**: Плечевые пики.
4. **R**: Округлые пики. Возникают, когда пики почти равной высоты сливаются при очень низком 
(но не нулевом) разрешении.
